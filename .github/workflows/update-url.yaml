name: Update urls

on:
  workflow_dispatch:
  schedule:
    - cron: '0 18 * * *' # 北京时间每天 2 点执行

jobs:
  download-and-upload:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v2

    - name: Download URLs and upload to Gist
      env:
        MY_TOKEN: ${{ secrets.MY_TOKEN }}
        URLS: ${{ secrets.URLS }}
      run: |
        for url in $URLS; do
          filename="$(echo $url | sed 's~http[s]*://~~g' | sed 's~www\.~~g').txt"
          curl -o $filename $url
          gist_url=$(curl -s -XPOST https://api.github.com/gists -H "Authorization: token $MY_TOKEN" -H "Content-Type: application/json" -d '{"files": {"'$filename'": {"content": "'$(cat $filename)'"}}, "public": true}' | grep -o '"html_url": ".*"' | cut -d'"' -f4)
          echo "$filename: $gist_url"
        done
