# GDB

## 启动 GDB

对 C/C++ 程序的调试，需要在编译前就加上 `-g` 选项

```bash
$ g++ -g hello.cpp -o hello
```

调试可执行文件|

```bash
$ gdb hello
```

hello 是可执行文件的名字

还有调试 core 文件和调试服务程序的，不知道是说明东东就不写了。

## GDB 交互命令

-   **运行**

    | 选项            | 说明                                                         |
    | --------------- | ------------------------------------------------------------ |
    | run<br />r      | 运行程序，当遇到断点后，程序会在断点处停止运行，等待用户输入下一步的命令 |
    | continue<br />c | 继续执行，到下一个断点处（或运行结束）                       |
    | next<br />n     | 单步跟踪程序，当遇到函数调用时，也不进入此函数体             |
    | step<br />s     | 单步调试如果有函数调用，则进入函数；与命令n不同，n是不进入调用的函数的 |
    | until           | 当你厌倦了在一个循环体内单步跟踪时，这个命令可以运行程序直到退出循环体 |
    | until + 行号    | 运行至某行，不仅仅用来跳出循环                               |
    | finish          | 运行程序，直到当前函数完成返回，并打印函数返回时的堆栈地址和返回值及参数值等信息 |
    | call 函数(参数) | 调用程序中可见的函数，并传递“参数”，如|call gdb_test(55)    |
    | quit<br />q     | 退出 gdb                                                     |

-   设置断点

    | 选项               | 说明                                                         |
    | ------------------ | ------------------------------------------------------------ |
    | break n<br />b n   | 在第 n 行处设置断点（可以带上代码路径和代码名称| b hello.cpp:578）（也可以后面加上 `if x>y` 作为条件断点设置 |
    | break  func        | 在函数 func() 的入口处设置断点                               |
    | delete  断点号 n   | 删除第 n 个断点                                              |
    | disable 断点号 n   | 暂停                                                         |
    | enable 断点号 n    | 开启                                                         |
    | clear 行号 n       | 清除第 n 行的断点                                            |
    | indo b             | 显示当前程序的断点设置情况                                   |
    | delete breakpoints | 清除所有断点                                                 |

-   查看源代码

    | 选项        | 说明                                                    |
    | ----------- | ------------------------------------------------------- |
    | list<br />l | 列出程序的源代码，默认每次显示10行                      |
    | list 行号   | 将显示当前文件以“行号”为中心的前后10行代码，如|list 12 |
    | list 函数名 | 将显示“函数名”所在函数的源代码，如|list main           |
    | list        | 不带参数，将接着上次 list 的命令，输出下边的内容        |

-   打印表达式
    | 选项        | 说明                                                    |
    | ----------- | ------------------------------------------------------- |
    | print 表达式<br />p 表达式|其中“表达式”可以是任何当前正在被测试程序的有效表达式，比如当前正在调试C语言的程序，那么“表达式”可以是任何C语言的有效表达式，包括数字，变量甚至是函数调用。|
    | print a|将显示整数 a 的值|
    | print ++a|将把 a 中的值加1,并显示出来|
    | print name|将显示字符串 name 的值|
    | print gdb_test(22)|将以整数22作为参数调用 gdb_test() 函数|
    | print gdb_test(a)|将以变量 a 作为参数调用 gdb_test() 函数|
    | display 表达式|在单步运行时将非常有用，使用display命令设置一个表达式后，它将在每次单步进行指令后，紧接着输出被设置的表达式及值。如： `display a`|
    | watch 表达式|设置一个监视点，一旦被监视的“表达式”的值改变，gdb将强行终止正在被调试的程序。如：` watch a` |
    | whatis |查询变量或函数|
    | info function| 查询函数 |
    | info locals | 显示当前堆栈页的所有变量 |

-   查询运行信息
    | 选项        | 说明                                                    |
    | ----------- | ------------------------------------------------------- |
    | where/bt |当前运行的堆栈列表 |
    | bt backtrace | 显示当前调用堆栈 |
    | up/down | 改变堆栈显示的深度 |
    | set args | 参数:指定运行时的参数 |
    | show args|查看设置好的参数 |
    | info program| 来查看程序的是否在运行，进程号，被暂停的原因 |

-   分割窗口
    | 选项        | 说明                                                    |
    | ----------- | ------------------------------------------------------- |
    |ayout | 用于分割窗口，可以一边查看代码，一边测试|
    | layout src | 显示源代码窗口|
    | layout asm | 显示反汇编窗口 |
    | layout regs | 显示源代码/反汇编和CPU寄存器窗口 |
    | layout split | 显示源代码和反汇编窗口 |
    | Ctrl + L | 刷新窗口 |

-   交互模式下直接回车的作用是重复上一指令，对于单步调试非常方便

---

以上均复制于

https://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/gdb.html